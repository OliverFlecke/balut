(this["webpackJsonpbalut-react"]=this["webpackJsonpbalut-react"]||[]).push([[0],{49:function(e,t,n){},50:function(e,t,n){"use strict";n.r(t);var c=n(2),r=n.n(c),a=n(29),i=n.n(a),s=n(9),l=n(21),o=n(5),u=n(3),j=n(0),b=function(e){return Object(j.jsx)("button",Object(u.a)(Object(u.a)({},e),{},{className:"rounded p-2 pr-3 pl-3 m-1 text-xl ".concat(f(e.variant)," ").concat(e.className)}))};function f(e){return"disabled"===e?"bg-gray-400 dark:bg-gray-700 cursor-not-allowed":"bg-blue-400"}var d,O=function(e){return Object(j.jsx)("ul",{className:"inline p-0 m-0 list-none ".concat(e.className),children:e.children})},h=function(e){return Object(j.jsx)("li",{className:"flex justify-between ".concat(e.className),children:e.children})},x=function(e){return Object(j.jsx)("h3",Object(u.a)(Object(u.a)({},e),{},{className:"p-0 m-0 mb-2 text-xl text-center text-gray-700 dark:text-gray-400 ".concat(e.className)}))},m=function(e){return Object(j.jsx)("h4",Object(u.a)(Object(u.a)({},e),{},{className:"text-lg my-2 text-gray-700 dark:text-gray-400 ".concat(e.className)}))},v=function(e){return Object(j.jsx)("form",Object(u.a)(Object(u.a)({},e),{},{className:"w-full flex flex-col"}))},p=function(e){return Object(j.jsx)("input",Object(u.a)(Object(u.a)({},e),{},{className:"border rounded p-2 my-2"}))},g=function(){return Object(j.jsx)("hr",{className:"w-full"})};function y(e){return e===d.FullHouse?"Full house":d[e]}!function(e){e[e.Fours=0]="Fours",e[e.Fives=1]="Fives",e[e.Sixes=2]="Sixes",e[e.Straight=3]="Straight",e[e.FullHouse=4]="FullHouse",e[e.Chance=5]="Chance",e[e.Balut=6]="Balut"}(d||(d={}));var w=function(e){return Object(j.jsx)("table",Object(u.a)(Object(u.a)({},e),{},{className:"border-collapse w-full max-w-3xl"}))},k=function(e){return Object(j.jsx)("tr",Object(u.a)({},e))},N=function(e){return Object(j.jsx)("th",Object(u.a)(Object(u.a)({},e),{},{className:"text-left border p-1 ".concat(e.className)}))},S=function(e){return Object(j.jsx)("td",Object(u.a)(Object(u.a)({},e),{},{style:{minWidth:"2.5rem"},className:"border p-1 text-center ".concat(e.className)}))};function C(e){return Object.keys(e).filter((function(t){return"number"!==typeof e[t]})).map((function(e){return parseInt(e)}))}var F=n(26);function I(e,t){return(null!==t&&void 0!==t?t:Object(F.a)(Array(5))).map((function(t,n){return e[n]?t:Math.floor(6*Math.random())+1}))}function B(){return Object(F.a)(Array(5)).map((function(){return!1}))}function J(e){return e.reduce((function(e,t){return e+t}),0)}var M=function(e){var t=e.points;return Object(j.jsx)("div",{className:"flex justify-end w-full my-2 max-w-3xl",children:Object(j.jsxs)("div",{className:"text-2xl border-b-2 border-white",children:[Object(j.jsx)("span",{children:"Final score: "}),Object(j.jsx)("span",{children:t})]})})},D=function(e){var t=e.total,n=e.extraPoints;return Object(j.jsx)("tfoot",{children:Object(j.jsxs)(k,{children:[Object(j.jsx)("td",{colSpan:5}),Object(j.jsx)(S,{children:t}),Object(j.jsx)(S,{children:n})]})})},E=function(){return Object(j.jsx)("thead",{children:Object(j.jsxs)(k,{children:[Object(j.jsx)("td",{colSpan:5}),Object(j.jsx)(S,{children:"Total"}),Object(j.jsx)(S,{children:"Points"})]})})},R=function(e){var t=e.category,n=e.value,r=e.index,a=e.suggestion,i=e.writeValue,s=Object(c.useCallback)((function(){a&&i&&i(t,r,a)}),[i,r,a,t]);return Object(j.jsx)(T,{onClick:s,variant:a?"suggestion":"default",children:H(null!==n?n:a)})};function H(e){return void 0===e||null===e||0===e?"":"X"===e?"X":e.toString()}var T=function(e){return Object(j.jsx)(S,Object(u.a)(Object(u.a)({},e),{},{className:"py-1 h-8 select-none bg-gray-300 dark:bg-gray-700 ".concat("suggestion"===e.variant?"text-blue-600":"")}))},A=n(30);function V(e,t){switch(e){case d.Balut:return 2*t.filter((function(e){return"number"===typeof e&&0!==e})).length;case d.Chance:return X(t)>=100?2:0;case d.FullHouse:return 4===t.filter((function(e){return"number"===typeof e})).length?3:0;case d.Straight:return 4===t.filter((function(e){return"number"===typeof e})).length?4:0;case d.Sixes:return X(t)>=78?2:0;case d.Fives:return X(t)>=65?2:0;case d.Fours:return X(t)>=52?2:0}}function X(e){return e.filter((function(e){return"number"===typeof e})).map((function(e){return e})).reduce((function(e,t){return e+t}),0)}var P=[300,350,400,450,500,550,600,650];function W(e,t){if(!t)return null;switch(e){case d.Fours:return J(t.filter((function(e){return 4===e})));case d.Fives:return J(t.filter((function(e){return 5===e})));case d.Sixes:return J(t.filter((function(e){return 6===e})));case d.Straight:return function(e){return e.some((function(e){return 1===e||6===e}))&&[2,3,4,5].every((function(t){return e.includes(t)}))}(t)?J(t):"X";case d.FullHouse:return function(e){var t=new Set(e);if(2!==t.size)return!1;return Array.from(t).every((function(t){var n=e.filter((function(e){return e===t})).length;return 3===n||2===n}))}(t)?J(t):"X";case d.Chance:return J(t);case d.Balut:return t.every((function(e){return e===t[0]}))?J(t)+20:"X"}}var U=function(e){var t=e.category,n=e.values,r=e.roll,a=e.writeValue,i=Object(c.useMemo)((function(){return y(t)}),[t]),s=X(n),l=V(t,n),o=W(t,r),u=n.findIndex((function(e){return null===e}));return Object(j.jsxs)(k,{children:[Object(j.jsx)(N,{children:i}),n.map((function(e,n){return Object(j.jsx)(R,{index:n,value:e,category:t,suggestion:u===n?0===o?"X":o:void 0,writeValue:a},n)})),Object(j.jsx)(S,{children:s}),Object(j.jsx)(S,{children:l})]})},z=C(d),G=function(e){var t=e.values,n=e.roll,c=e.writeValue,r=J(Object.keys(t).map((function(e){return X(t[e])}))),a=function(e){var t,n=-2,c=Object(A.a)(P);try{for(c.s();!(t=c.n()).done&&!(e<t.value);)n++}catch(r){c.e(r)}finally{c.f()}return n}(r),i=a+J(C(d).map((function(e){return V(e,t[d[e]])})));return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsxs)(w,{children:[Object(j.jsx)(E,{}),Object(j.jsx)("tbody",{children:z.map((function(e){return Object(j.jsx)(U,{category:e,values:t[d[e]],roll:n,writeValue:c},e)}))}),Object(j.jsx)(D,{extraPoints:a,total:r})]}),Object(j.jsx)(M,{points:i})]})},L=function(e){var t=e.clearBoard;return Object(j.jsx)("div",{className:"flex justify-end",children:Object(j.jsx)(b,{onClick:t,children:"New game"})})},Y=n(17),$=function(e){var t=e.dice,n=e.locked,r=e.index,a=e.toggleLock,i=Object(c.useCallback)((function(){return a(r)}),[a,r]),s=n?"red":"white";switch(t){case 1:return Object(j.jsx)(Y.FaDiceOne,Object(u.a)(Object(u.a)({},q),{},{color:s,onClick:i}));case 2:return Object(j.jsx)(Y.FaDiceTwo,Object(u.a)(Object(u.a)({},q),{},{color:s,onClick:i}));case 3:return Object(j.jsx)(Y.FaDiceThree,Object(u.a)(Object(u.a)({},q),{},{color:s,onClick:i}));case 4:return Object(j.jsx)(Y.FaDiceFour,Object(u.a)(Object(u.a)({},q),{},{color:s,onClick:i}));case 5:return Object(j.jsx)(Y.FaDiceFive,Object(u.a)(Object(u.a)({},q),{},{color:s,onClick:i}));case 6:return Object(j.jsx)(Y.FaDiceSix,Object(u.a)(Object(u.a)({},q),{},{color:s,onClick:i}))}return null},q={size:60},K=n(7),Q=n(8);function Z(e,t){var n=t.reduce(e);return localStorage.setItem("gameState",JSON.stringify(n)),n}function _(){return(e=d,Object.keys(e).filter((function(t){return"number"===typeof e[t]}))).reduce((function(e,t){return e[t]=[null,null,null,null],e}),{});var e}var ee=function(){function e(){Object(K.a)(this,e)}return Object(Q.a)(e,[{key:"reduce",value:function(e){return localStorage.removeItem("gameState"),Object(u.a)(Object(u.a)({},e),{},{values:_()})}}]),e}(),te=function(){function e(){Object(K.a)(this,e)}return Object(Q.a)(e,[{key:"reduce",value:function(e){return Object(u.a)(Object(u.a)({},e),{},{locked:B(),roll:void 0,rollNumber:0})}}]),e}(),ne=function(){function e(){Object(K.a)(this,e)}return Object(Q.a)(e,[{key:"reduce",value:function(e){return Object(u.a)(Object(u.a)({},e),{},{roll:I(e.locked,e.roll),rollNumber:e.rollNumber+1})}}]),e}(),ce=function(){function e(t,n,c){Object(K.a)(this,e),this.category=void 0,this.index=void 0,this.value=void 0,this.category=t,this.index=n,this.value=c}return Object(Q.a)(e,[{key:"reduce",value:function(e){var t={};return Object.assign(t,e.values),t[d[this.category]][this.index]=this.value,Object(u.a)(Object(u.a)({},e),{},{values:t})}}]),e}(),re=function(){function e(t){Object(K.a)(this,e),this.index=void 0,this.index=t}return Object(Q.a)(e,[{key:"reduce",value:function(e){var t=this;return Object(u.a)(Object(u.a)({},e),{},{locked:e.locked.map((function(e,n){return t.index===n?!e:e}))})}}]),e}(),ae=function(e){var t=e.onTurnFinished,n=Object(c.useReducer)(Z,function(){var e=localStorage.getItem("gameState");if(null!==e)try{return JSON.parse(e)}catch(t){}return{rollNumber:0,locked:B(),values:_()}}()),r=Object(s.a)(n,2),a=r[0],i=r[1],l=Object(c.useState)(a.roll),o=Object(s.a)(l,2),u=o[0],f=o[1];Object(c.useEffect)((function(){return f(a.roll)}),[a.roll]);var d=Object(c.useCallback)((function(){var e=setInterval((function(){f(I(a.locked,a.roll))}),50);setTimeout((function(){clearInterval(e),i(new ne)}),1e3)}),[i,a]),O=Object(c.useCallback)((function(e){return i(new re(e))}),[i]),h=Object(c.useCallback)((function(){i(new te)}),[i]),x=Object(c.useCallback)((function(e,n,c){var r=new ce(e,n,c);i(r),h(),t&&t(r.reduce(a).values)}),[i,h,a,t]),m=Object(c.useCallback)((function(){i(new ee),i(new te)}),[i]);return Object(j.jsxs)("div",{className:"flex flex-col items-center",children:[Object(j.jsx)(G,{roll:a.roll,values:a.values,writeValue:x}),Object(j.jsx)("h3",{children:0===a.rollNumber?"Roll your dice!":"Roll #".concat(a.rollNumber," of 3")}),Object(j.jsx)("div",{className:"flex justify-center flex-wrap",children:null===u||void 0===u?void 0:u.map((function(e,t){return Object(j.jsx)($,{dice:e,index:t,toggleLock:O,locked:a.locked[t]},t)}))}),Object(j.jsx)("div",{className:"flex my-2",children:Object(j.jsx)(b,{variant:3===a.rollNumber?"disabled":"primary",onClick:d,disabled:3===a.rollNumber,children:"Roll"})}),Object(j.jsx)(L,{clearBoard:m})]})},ie=n(18),se=(n(41),function(){function e(t){Object(K.a)(this,e),this.connection=void 0,this.connection=t}return Object(Q.a)(e,[{key:"reduce",value:function(e){return Object(u.a)(Object(u.a)({},e),{},{connection:this.connection})}}]),e}()),le=function(){function e(t){Object(K.a)(this,e),this.session=void 0,this.session=t}return Object(Q.a)(e,[{key:"reduce",value:function(e){return Object(u.a)(Object(u.a)({},e),{},{session:this.session})}}]),e}(),oe=function(){function e(t){Object(K.a)(this,e),this.name=void 0,this.name=t}return Object(Q.a)(e,[{key:"reduce",value:function(e){return Object(u.a)(Object(u.a)({},e),{},{name:this.name})}}]),e}(),ue=function(){function e(t,n){Object(K.a)(this,e),this.values=void 0,this.name=void 0,this.name=t,this.values=n}return Object(Q.a)(e,[{key:"reduce",value:function(e){var t=this;return console.log("Updating player state for ".concat(this.name)),Object(u.a)(Object(u.a)({},e),{},{players:e.players.map((function(e){return e.name===t.name?Object(u.a)(Object(u.a)({},e),{},{values:t.values}):e}))})}}]),e}(),je=function(){function e(t){Object(K.a)(this,e),this.name=void 0,this.name=t}return Object(Q.a)(e,[{key:"reduce",value:function(e){var t=this;return console.debug("Adding player ".concat(this.name," to game")),Object(u.a)(Object(u.a)({},e),{},{players:e.players.filter((function(e){return e.name!==t.name})).concat({name:this.name,values:_()})})}}]),e}(),be=function(e){var t=e.name,n=e.players,r=e.connection,a=e.session,i=e.dispatch,l=Object(c.useState)(0),o=Object(s.a)(l,2),u=o[0],b=o[1],f=Object(c.useCallback)((function(e){b(e)}),[b]),d=Object(c.useCallback)((function(e){console.log("Sending state"),r.invoke("sendState",a,t,e)}),[r,a,t]);return Object(c.useEffect)((function(){r.on("newState",(function(e,t){i(new ue(e,t))}))}),[r,i]),Object(j.jsx)("div",{children:Object(j.jsxs)(ie.d,{selectedIndex:u,onSelect:f,children:[Object(j.jsxs)(ie.b,{children:[Object(j.jsx)(ie.a,{children:"Me"}),n.map((function(e){return Object(j.jsx)(ie.a,{children:e.name},e.name)}))]}),Object(j.jsx)(ie.c,{children:Object(j.jsx)(ae,{onTurnFinished:d})}),n.map((function(e){return Object(j.jsx)(ie.c,{children:Object(j.jsx)(G,{values:e.values})},e.name)}))]})})},fe="text-lg mx-2 pointer no-underline text-blue-400",de=function(e){var t=e.shouldShowMultiplayer,n=e.showMultiplayer;return Object(j.jsx)("nav",{children:Object(j.jsxs)(O,{className:"flex flex-row",children:[Object(j.jsx)(h,{children:Object(j.jsx)(l.b,{to:"/",className:fe,children:"Game"})}),Object(j.jsx)(h,{children:Object(j.jsx)(l.b,{to:"/rules",className:fe,children:"Rules"})}),t&&Object(j.jsx)(h,{children:Object(j.jsx)("a",{onClick:n,className:fe,children:"Multiplayer"})})]})})},Oe=[[d.Fours,"52 or more",2],[d.Fives,"65 or more",2],[d.Sixes,"78 or more",2],[d.Straight,"All straights",4],[d.FullHouse,"All full house",3],[d.Chance,"100 or more",2],[d.Balut,"Each balut",2]],he=[[0,299,-2],[300,349,-1],[350,399,0],[400,449,1],[450,499,2],[500,549,3],[549,599,4],[600,649,5],[650,"or above",6]],xe=function(){return Object(j.jsx)("div",{className:"w-full flex justify-center flex-wrap",children:Object(j.jsxs)("div",{className:"w-full max-w-sm",children:[Object(j.jsx)(x,{children:"How to calculate points"}),Object(j.jsx)(O,{children:Oe.map((function(e){var t=Object(s.a)(e,3),n=t[0],c=t[1],r=t[2];return Object(j.jsxs)(h,{children:[Object(j.jsxs)("span",{children:[y(n)," - ",c]}),Object(j.jsxs)("strong",{children:[r," points"]})]},n)}))}),Object(j.jsx)(m,{children:"Extra points from total score"}),Object(j.jsx)(O,{children:he.map((function(e){var t=Object(s.a)(e,3),n=t[0],c=t[1],r=t[2];return Object(j.jsxs)(h,{children:[Object(j.jsxs)("span",{children:[n," - ",c]}),Object(j.jsxs)("strong",{children:[r," points"]})]},r)}))})]})})},me=n(33);var ve=function(e){var t=e.children,n=e.visible,r=e.dismiss,a=Object(c.useCallback)((function(){r&&r()}),[r]),i=Object(c.useCallback)((function(e){e.stopPropagation()}),[]);return n?Object(j.jsx)("div",{onClick:a,className:"fixed top-0 left-0 w-full h-full bg-black bg-opacity-70",children:Object(j.jsx)("div",{className:"w-full h-full flex flew-row justify-center items-center",children:Object(j.jsx)("div",{onClick:i,className:"max-w-xl flex justify-center items-center p-4 bg-gray-700 rounded",children:t})})}):null},pe=function(e){var t=e.visible,n=e.dismiss,r=e.state,a=e.dispatch,i=e.connection,l=Object(c.useState)(!1),o=Object(s.a)(l,2),u=o[0],f=o[1],d=Object(c.useRef)(null),O=Object(c.useRef)(null);Object(c.useEffect)((function(){return i&&(i.on("joinedSession",(function(e,t){console.log("".concat(t," joined ").concat(e)),a(new je(t)),i.invoke("sendWelcome",e,r.name)})),i.on("welcomeFrom",(function(e){console.log("".concat(e," says welcome")),a(new je(e))}))),function(){null===i||void 0===i||i.off("joinedSession"),null===i||void 0===i||i.off("welcomeFrom")}}),[i,r.name,a]);var h=Object(c.useCallback)((function(){var e,t;i&&(i.on("createdSession",(function(e){a(new le(e)),n()})),i.invoke("createGame"),a(new oe(null!==(e=null===(t=d.current)||void 0===t?void 0:t.value)&&void 0!==e?e:"")))}),[i,a,n]),m=Object(c.useCallback)((function(e){e.preventDefault(),h()}),[h]),y=Object(c.useCallback)((function(e,t,c){console.log("".concat(c," is joining ").concat(t)),e&&t&&c&&(e.invoke("join",t,c),a(new le(t)),a(new oe(c)),n())}),[n,a]),w=Object(c.useCallback)((function(e){var t,n;e.preventDefault(),y(i,null===(t=O.current)||void 0===t?void 0:t.value,null===(n=d.current)||void 0===n?void 0:n.value)}),[i,y]);return Object(c.useEffect)((function(){(function(e){var t=(new me.a).withUrl(e).build();return t.on("connected",(function(){console.log("connected")})),new Promise((function(e,n){t.start().then((function(){console.log("Connection started"),e(t)})).catch((function(e){console.error("Unable to connect to server"),n(e)}))}))})(ye).then((function(e){a(new se(e)),r.session&&r.name&&y(e,r.session,r.name)})).catch((function(){return f(!0)}))}),[a,y,f,r.name,r.session]),u?Object(j.jsx)(ve,{visible:t,dismiss:n,children:Object(j.jsx)(j.Fragment,{children:"Could not reach server. Try again later"})}):Object(j.jsx)(ve,{visible:t,dismiss:n,children:Object(j.jsxs)("div",{className:"flex flex-col justify-center",children:[Object(j.jsx)(x,{children:"Create new game"}),Object(j.jsxs)(v,{onSubmit:m,children:[Object(j.jsx)(p,{ref:d,placeholder:"Your name"}),Object(j.jsx)(b,{type:"submit",children:"Start"})]}),Object(j.jsx)(g,{}),Object(j.jsx)(x,{children:"Join a game"}),Object(j.jsxs)(v,{onSubmit:w,children:[Object(j.jsx)(p,{ref:O,placeholder:"Enter code"}),Object(j.jsx)(b,{type:"submit",children:"Join"})]})]})})};n(49);function ge(e,t){var n=t.reduce(e),c=JSON.parse(JSON.stringify(n));return c.connection=void 0,localStorage.setItem("appState",JSON.stringify(c)),n}var ye="https://localhost:5001/play";var we=function(){var e=Object(c.useState)(!1),t=Object(s.a)(e,2),n=t[0],r=t[1],a=Object(c.useReducer)(ge,function(){var e=localStorage.getItem("appState");if(e)try{return JSON.parse(e)}catch(t){}return{players:[]}}()),i=Object(s.a)(a,2),u=i[0],b=i[1];return Object(j.jsx)(l.a,{children:Object(j.jsxs)("main",{className:"p-3 font-display w-full min-h-screen h-full bg-gray-200 dark:bg-gray-900 text-gray-900 dark:text-gray-200",children:[Object(j.jsxs)("header",{className:"flex flex-row justify-between",children:[Object(j.jsx)("h1",{className:"m-0 text-5xl no-underline",children:"Balut"}),Object(j.jsx)(de,{shouldShowMultiplayer:!!u.connection,showMultiplayer:function(){return r((function(e){return!e}))}})]}),Object(j.jsx)("section",{children:Object(j.jsxs)(o.c,{children:[Object(j.jsx)(o.a,{path:"/rules",children:Object(j.jsx)(xe,{})}),Object(j.jsx)(o.a,{path:"/",children:u.session&&u.connection&&u.name?Object(j.jsx)(be,{name:u.name,players:u.players,connection:u.connection,session:u.session,dispatch:b}):Object(j.jsx)(ae,{})})]})}),Object(j.jsx)(pe,{state:u,dispatch:b,visible:n,dismiss:function(){return r(!1)},connection:u.connection})]})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(j.jsx)(r.a.StrictMode,{children:Object(j.jsx)(we,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[50,1,2]]]);
//# sourceMappingURL=main.25e58d44.chunk.js.map